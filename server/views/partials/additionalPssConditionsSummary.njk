{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}

{% macro additionalPssConditions(licence, isEditable) %}
    {% macro additionalConditionHtml(template, data) %}
        <div>
            {{ template }}
        </div>
        {% if data.length %}
            <div class="govuk-!-font-weight-bold govuk-!-margin-top-3">
                {% for entry in data | separatedDataByFieldName %}
                    <span class="govuk-!-display-block govuk-!-margin-top-2">{{ entry | formatAddress }}</span>
                {% endfor %}
            </div>
        {% endif %}
    {% endmacro %}

    <div class="govuk-grid-row check-answers-header">
        <div class="govuk-grid-column-three-quarters">
            <h2 id="additional-pss-conditions-heading" class="govuk-heading-m">Additional post sentence requirements details</h2>
        </div>
        {% if isEditable %}
            <div class="govuk-grid-column-one-quarter check-answers-header__change-link">
                <a href="{{ '/licence/create/id/' + licence.id + '/additional-pss-conditions?fromReview=true'}}" class="govuk-link govuk-!-font-size-19">Change</a>
            </div>
        {% endif %}
    </div>

    {% set additionalPssConditions = [] %}

    {% for condition in licence.additionalPssConditions %}
        {% set additionalPssConditions = (additionalPssConditions.push({
            key: {  text: condition.category },
            value: { html: additionalConditionHtml(condition.text, condition.data) },
            actions: {
                items: [
                    {
                        href: "/licence/create/id/" + licence.id + "/additional-pss-conditions/condition/" + condition.id + "?fromReview=true",
                        text: "Edit",
                        visuallyHiddenText: "name"
                    }
                ]
            } if condition | checkConditionRequiresInput and isEditable
        }), additionalPssConditions) %}
    {% endfor %}

    {% if additionalPssConditions.length > 0 %}
    {{ govukSummaryList({
        attributes: { id: 'additional-pss-conditions-details' },
        classes: 'govuk-!-margin-bottom-9',
        rows: additionalPssConditions
    }) }}
    {% else %}
        <p class="govuk-body govuk-!-margin-bottom-9">No additional post sentence requirements have been added to this licence</p>
    {% endif %}
{% endmacro %}
