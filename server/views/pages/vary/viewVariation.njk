{% extends "layout.njk" %}

{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "partials/inductionMeetingDetailsSummary.njk" import inductionMeetingDetails %}
{% from "partials/additionalLicenceConditionsSummary.njk" import additionalLicenceConditions %}
{% from "partials/additionalPssConditionsSummary.njk" import additionalPssConditions %}
{% from "partials/bespokeConditionsSummary.njk" import bespokeConditions %}

{% set pageTitle = applicationName + " - Vary a licence - View licence variation" %}
{% set pageId = "view-variation-page" %}
{% set backLinkHref = "/licence/vary/caseload" %}

{% macro cta(callToActions, licence) %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            {% if callToActions.shouldShowVaryButton %}
                {{ govukButton({
                    text: "Vary licence",
                    classes: "govuk-button--primary govuk-!-margin-right-1",
                    href: '/licence/vary/id/' + licence.id + '/confirm-vary-action',
                    attributes: { 'data-qa': 'vary-licence' }
                }) }}
            {% endif %}
            {% if callToActions.shouldShowPrintButton %}
                {{ govukButton({
                    text: "Print",
                    classes: "govuk-button--primary govuk-!-margin-right-1",
                    href: '#'
                }) }}
            {% endif %}
            {% if callToActions.shouldShowEditAndDiscardButton %}
                {% set class = "govuk-button--secondary" if callToActions.shouldShowPrintButton else "govuk-button--primary" %}
                {{ govukButton({
                    text: "Edit variation",
                    classes: class + " govuk-!-margin-right-1",
                    href: '/licence/vary/id/' + licence.id + '/confirm-amend-variation'
                }) }}
                {{ govukButton({
                    text: "Discard variation",
                    classes: "govuk-button--secondary",
                    href: '/licence/vary/id/' + licence.id + '/confirm-discard-variation'
                }) }}
            {% endif %}
        </div>
    </div>
{% endmacro %}

{% block content %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            {% if licence.isVariation %}
                {% if licence.typeCode === 'AP' %}
                    <h1 class="govuk-heading-l">View licence variation</h1>
                {% elseif licence.typeCode === 'AP_PSS' %}
                    <h1 class="govuk-heading-l">Vary licence and post sentence supervision order variation</h1>
                {% elseif licence.typeCode === 'PSS' %}
                    <h1 class="govuk-heading-l">Vary post sentence supervision order variation</h1>
                {% endif %}
            {% else %}
                {% if licence.typeCode === 'AP' %}
                    <h1 class="govuk-heading-l">View licence</h1>
                {% elseif licence.typeCode === 'AP_PSS' %}
                    <h1 class="govuk-heading-l">View licence and post sentence supervision</h1>
                {% elseif licence.typeCode === 'PSS' %}
                    <h1 class="govuk-heading-l">View post sentence supervision order</h1>
                {% endif %}
            {% endif %}
        </div>
    </div>

    {{ cta(callToActions, licence) }}

    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            {% if licence.typeCode === 'AP' or licence.typeCode === 'AP_PSS' %}
                {{ additionalLicenceConditions(licence, expandedLicenceConditions) }}
                {{ bespokeConditions(licence) }}
            {% endif %}
            {% if licence.typeCode === 'PSS' or licence.typeCode === 'AP_PSS' %}
                {{ additionalPssConditions(licence, expandedPssConditions) }}
            {% endif %}
        </div>
    </div>

    {{ cta(callToActions, licence) }}
{% endblock %}
