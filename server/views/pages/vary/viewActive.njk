{% extends "layout.njk" %}

{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "partials/inductionMeetingDetailsSummary.njk" import inductionMeetingDetails %}
{% from "partials/additionalLicenceConditionsSummary.njk" import additionalLicenceConditions %}
{% from "partials/additionalPssConditionsSummary.njk" import additionalPssConditions %}
{% from "partials/bespokeConditionsSummary.njk" import bespokeConditions %}
{% from "partials/varyCallToActions.njk" import cta %}

{% set pageTitle = applicationName + " - Vary a licence - Active licence" %}
{% set isInVariation = licence.statusCode == 'VARIATION_IN_PROGRESS' or licence.statusCode == 'VARIATION_SUBMITTED' 
    or licence.statusCode == 'VARIATION_REJECTED' or licence.statusCode == 'VARIATION_APPROVED' %}
{% set pageId = "view-active-licence-page" %}
{% set backLinkHref = "/licence/vary/caseload" %}

{% block content %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            {% if licence.typeCode === 'AP' %}
                <h1 class="govuk-heading-l">View licence details</h1>
            {% elseif licence.typeCode === 'AP_PSS' %}
                <h1 class="govuk-heading-l">View licence and post sentence supervision order</h1>
            {% elseif licence.typeCode === 'PSS' %}
                <h1 class="govuk-heading-l">View post sentence supervision order details</h1>
            {% endif %}
        </div>
    </div>

    {{ cta(callToActions, licence) }}

    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            {% if ( licence.typeCode === 'AP' or licence.typeCode === 'AP_PSS') 
                and (not licence.isInPssPeriod or (licence.isInPssPeriod and (not isInVariation and not licence.isActivatedInPssPeriod))) %}
                {{ additionalLicenceConditions({
                    licence: licence, 
                    additionalConditions: additionalConditions, 
                    conditionsWithUploads: conditionsWithUploads, 
                    isEditable: null, 
                    validationErrors: [], 
                    hideHeading: null, 
                    showConditionCountSelectedText: null
                }) }}
                {{ bespokeConditions({
                    licence:licence, 
                    isEditable: null, 
                    hideHeading: null, 
                    showConditionCountSelectedText: null, 
                    bespokeConditionsToDisplay: null
                }) }}
            {% endif %}
            {% if licence.typeCode === 'PSS' or licence.typeCode === 'AP_PSS' %}
                {{ additionalPssConditions({
                    licence: licence, 
                    isEditable: null, 
                    validationErrors: [], 
                    hideHeading: null, 
                    showConditionCountSelectedText: null
                }) }}
            {% endif %}
            {% if licence.typeCode === 'AP_PSS' and licence.isInPssPeriod and (isInVariation or licence.isActivatedInPssPeriod) 
                and (additionalConditions.length or bespokeConditionsToDisplay.length)  %}
                <div>
                    <h2 class="govuk-heading-m" id="conditions-expired">Conditions from expired licence</h2>
                    <p>This person reached their LED on <span class="bold">{{ licence.licenceExpiryDate | datetimeToDate }}</span>, 
                    so the conditions from their standard determinate licence can no longer be varied.</p>
                    <details class="govuk-details" data-module="govuk-details">
                        <summary class="govuk-details__summary">
                            <span class="govuk-details__summary-text">
                                View conditions from expired licence
                            </span>
                        </summary>
                        <div class="govuk-details__text">
                            {{ additionalLicenceConditions({
                                licence: licence, 
                                additionalConditions: additionalConditions, 
                                conditionsWithUploads: conditionsWithUploads, 
                                isEditable: null, 
                                validationErrors: [], 
                                hideHeading: null, 
                                showConditionCountSelectedText: null
                            }) }}
                            {{ bespokeConditions({
                                licence: licence, 
                                isEditable: null, 
                                hideHeading: null, 
                                showConditionCountSelectedText: null, 
                                bespokeConditionsToDisplay: bespokeConditionsToDisplay
                            }) }}
                        </div>
                    </details>
                </div>
            {% endif %}
            
        </div>
    </div>

    {{ cta(callToActions, licence) }}

{% endblock %}
