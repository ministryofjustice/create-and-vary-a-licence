{% extends "layout.njk" %}

{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "partials/statusBadge.njk" import statusBadge %}

{% set pageTitle = applicationName + " - view an approved licence" %}
{% set pageId = "view-cases-page" %}
{% set backLinkHref = "/" %}
{% set noJsBackLink = true %}

{% set licences = [] %}

{% for case in cases %}
    {% set licences = (licences.push([
        {
            attributes: { id: 'name-' + loop.index },
            html: '<button type="submit" name="licenceId" value=' + case.licenceId +
            ' class="link-button govuk-heading-s">' +
            case.forename + ' ' + case.surname +
            '</button>'
        },
        {
            attributes: { id: 'nomis-id-' + loop.index },
            text: case.nomisId
        },
        {
            attributes: { id: 'com-' + loop.index },
            html: '<a class="govuk-link" href="/licence/view/id/' + case.licenceId + '/com-details">' + case.comFirstName + " " + case.comLastName + '</a>'
        },
        {
            attributes: { id: 'conditional-release-date-' + loop.index },
            text: case.conditionalReleaseDate | datetimeToDate
        },
        {
            attributes: {
                id: 'licence-status-' + loop.index
            },
            html: statusBadge({ status: case.licenceStatus, size: 'small' }, statusConfig)
        }
    ]), licences) %}
{% endfor %}

{% block content %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-three-quarters">
            <h1 class="govuk-heading-xl">Print an approved licence</h1>
        </div>
    </div>

    <form method="POST">
        <input type="hidden" name="_csrf" value="{{ csrfToken }}"/>

        {{ govukTable({
            caption: "Print an approved licence",
            captionClasses: "govuk-visually-hidden",
            head: [
                { text: "Name" },
                { text: "Prison number" },
                { text: "Community offender manager" },
                { text: "Conditional release date" },
                { text: "Status" }
            ],
            rows: licences
        }) }}

        {% if licences.length === 0 %}
            <div class="govuk-grid-row">
                <div class="govuk-grid-column-three-quarters">
                    <h3 class="govuk-heading-s">There are no licences to print</h3>
                </div>
            </div>
        {% endif %}
    </form>
{% endblock %}
