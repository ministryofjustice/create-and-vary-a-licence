{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/details/macro.njk" import govukDetails %}
{% from "govuk/components/table/macro.njk" import govukTable %}

{% macro hdcCurfewTimes(hdcLicenceData) %}
    {% set addressLine2Html = hdcLicenceData.curfewAddress.addressLine2 | escape + ", " if hdcLicenceData.curfewAddress.addressLine2 | length%}
    {% set countyHtml = hdcLicenceData.curfewAddress.county | escape + ", " if hdcLicenceData.curfewAddress.county | length%}


    {{ govukSummaryList({
        attributes: {'data-qa': 'hdc-curfew-details'},
        rows: [
            {
                key: {text: 'Address'}, 
                value: {
                    html: "<p>" + hdcLicenceData.curfewAddress.addressLine1 | escape + ", " + 
                          addressLine2Html + 
                          hdcLicenceData.curfewAddress.townOrCity | escape + ", " +
                          countyHtml + 
                          hdcLicenceData.curfewAddress.postcode | escape + "</p>",
                    classes: "curfew-address"
                }
            },
            {
                key: { text: 'First night curfew hours' }, 
                value: {
                    text: hdcLicenceData.firstNightCurfewHours.firstNightFrom | localTimeTo12h + " to " + hdcLicenceData.firstNightCurfewHours.firstNightUntil | localTimeTo12h,
                    classes: "first-night-curfew-hours"
                }
            },
            {
                classes: 'all-curfew-times-equal',
                key: {
                    text: 'Curfew hours'
                },
                value: {
                    html: hdcLicenceData.curfewTimes[0].fromDay | titlecase | escape + " to " + hdcLicenceData.curfewTimes[6].fromDay | titlecase | escape + "<br>" + 
                          hdcLicenceData.curfewTimes[0].fromTime  | localTimeTo12h + " to " + hdcLicenceData.curfewTimes[0].untilTime | localTimeTo12h,
                    classes: "curfew-hours"
                },
                actions: {
                    items: [
                        {
                            href: "#",
                            text: "Change",
                            visuallyHiddenText: "curfew hours"
                        }
                    ]
                }
            } if hdcLicenceData.allCurfewTimesEqual
        ]
    }) }}

    {{ govukDetails({
        summaryText: "How do I change the HDC first night curfew hours and address?",
        html: "Email createandvaryalicence@digital.justice.gov.uk to request a change to first night curfew hours and address."
    }) }}

    {% if not hdcLicenceData.allCurfewTimesEqual %}
        <h2 class="govuk-!-margin-bottom-3 govuk-!-margin-top-7 govuk-heading-m">Curfew hours</h3>

        {% set curfewRows = [] %}
        {% for curfewTime in hdcLicenceData.curfewTimes %}
        {% set curfewRows = (curfewRows.push([
            { text: curfewTime.fromTime | localTimeTo12h + " on " + curfewTime.fromDay | titlecase },
            { text: curfewTime.untilTime | localTimeTo12h + " on " + curfewTime.untilDay | titlecase },
            {}
        ]), curfewRows) %}
        {% endfor %}

        {{ govukTable({
            attributes: { 'data-qa': 'curfew-times-not-equal' },
            head: [
                { text: "Start time" },
                { text: "End time" },
                {
                    html: '<a href="#" class="govuk-link govuk-link--no-visited-state">Change</a>' +
                          '<span class="govuk-visually-hidden"> curfew hours</span>',
                    classes: "govuk-table__cell govuk-!-font-weight-regular govuk-!-text-align-right"
                }
            ],
            rows: curfewRows
        }) }}
    {% endif %}
{% endmacro %}