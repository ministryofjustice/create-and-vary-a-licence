{% extends "layout.njk" %}

{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "partials/inductionMeetingDetailsSummary.njk" import inductionMeetingDetails %}
{% from "partials/additionalLicenceConditionsSummary.njk" import additionalLicenceConditions %}
{% from "partials/additionalPssConditionsSummary.njk" import additionalPssConditions %}
{% from "partials/bespokeConditionsSummary.njk" import bespokeConditions %}
{% from "partials/variationSummary.njk" import variationSummary %}

{% set pageTitle = applicationName + " - Create a licence - Check your answers" %}
{% set pageId = "check-answers-page" %}

{% set isInProgress = licence.statusCode == 'IN_PROGRESS' or licence.statusCode == 'VARIATION_IN_PROGRESS' %}
{% set canChooseToEdit = licence.statusCode == 'APPROVED' or licence.statusCode == 'SUBMITTED' %}

{% block content %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            {% if licence.isVariation %}
                {% if licence.typeCode === 'AP' %}
                    <h1 class="govuk-heading-l">Vary licence details</h1>
                {% elseif licence.typeCode === 'AP_PSS' %}
                    <h1 class="govuk-heading-l">Vary licence and post sentence supervision order details</h1>
                {% elseif licence.typeCode === 'PSS' %}
                    <h1 class="govuk-heading-l">Vary post sentence supervision order details</h1>
                {% endif %}
            {% else %}
                {% if licence.typeCode === 'AP' %}
                    <h1 class="govuk-heading-l">Check licence details</h1>
                {% elseif licence.typeCode === 'AP_PSS' %}
                    <h1 class="govuk-heading-l">Check licence and post sentence supervision order details</h1>
                {% elseif licence.typeCode === 'PSS' %}
                    <h1 class="govuk-heading-l">Check post sentence supervision order details</h1>
                {% endif %}
            {% endif %}
        </div>
    </div>

    {% if canChooseToEdit %}
        <a id="edit-licence-button" href="{{'/licence/create/id/' + licence.id + '/edit'}}" class="govuk-button">Edit licence</a>
    {% endif %}

    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            {% if licence.isVariation %}
                {{ variationSummary(licence, isInProgress) }}
            {% else %}
                {{ inductionMeetingDetails(licence, isInProgress) }}
            {% endif %}

            {% if licence.typeCode === 'AP' or licence.typeCode === 'AP_PSS' %}
                {{ additionalLicenceConditions(licence, expandedLicenceConditions, isInProgress) }}
                {{ bespokeConditions(licence, isInProgress) }}
            {% endif %}

            {% if licence.typeCode === 'PSS' or licence.typeCode === 'AP_PSS' %}
                {{ additionalPssConditions(licence, expandedPssConditions, isInProgress) }}
            {% endif %}

            {% if isInProgress and licence.isVariation %}
                <div class="govuk-button-group">
                    {{ govukButton({
                        text: "View summary and add notes",
                        attributes: { 'data-qa': 'add-notes' },
                        href: '/licence/vary/id/' + licence.id + '/reason-for-variation'
                    }) }}
                    {{ govukButton({
                        text: "Discard changes",
                        classes: "govuk-button--secondary",
                        attributes: { 'data-qa': 'discard' },
                        href: '/licence/vary/id/' + licence.id + '/confirm-discard-variation'
                    }) }}
                </div>
            {% endif %}

            <form method="POST">
                <input type="hidden" name="_csrf" value="{{ csrfToken }}">
                <div class="govuk-button-group">
                    {% if isInProgress and not licence.isVariation %}
                        {{ govukButton({
                            text: "Send licence conditions to prison",
                            attributes: { 'data-qa': 'send-licence-conditions' }
                        }) }}
                    {% endif %}

                    {% if canChooseToEdit %}
                        <a id="edit-licence-button-2" href="{{'/licence/create/id/' + licence.id + '/edit'}}" class="govuk-button">Edit licence</a>
                    {% endif %}
                </div>
            </form>

            {% if licence.isVariation %}
                <a href="/licence/vary/caseload" class="govuk-link govuk-!-font-size-19">Return to caseload</a>
            {% else %}
                <a href="/licence/create/caseload" class="govuk-link govuk-!-font-size-19">Return to caseload</a>
            {% endif %}
        </div>
    </div>
{% endblock %}
