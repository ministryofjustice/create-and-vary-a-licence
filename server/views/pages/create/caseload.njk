{% extends "layout.njk" %}

{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/button/macro.njk" import govukButton %}

{% set pageTitle = applicationName + " - Create a licence - Caseload" %}
{% set pageId = "caseload-page" %}

{% set offenders = [] %}

{% for offender in caseload %}
    {% set offenders = (offenders.push([
        {
            attributes: {
                id: 'name-' + loop.index
            },
            html: '<h2 class="govuk-heading-m govuk-!-margin-bottom-3">' + offender.name + '</h2>'
        },
        {
            attributes: {
                id: 'crn-' + loop.index
            },
            text: offender.crnNumber
        },
        {
            attributes: {
                id: 'release-date-' + loop.index
            },
            text: offender.conditionalReleaseDate
        },
        {
            html: govukButton({
                attributes: {
                    id: 'create-licence-' + loop.index
                },
                text: "Create licence",
                classes: "govuk-button--secondary govuk-!-margin-bottom-0",
                name: "prisonerNumber",
                value: offender.prisonerNumber
            })
        }
    ]), offenders) %}
{% endfor %}

{% block content %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-three-quarters">
            <h1 class="govuk-heading-xl">Select a person to start creating their licence</h1>
        </div>
    </div>

    <form method="POST">
        <input type="hidden" name="_csrf" value="{{ csrfToken }}">
        {{ govukTable({
            caption: "Caseload",
            captionClasses: "govuk-visually-hidden",
            head: [
                {
                    text: "Name"
                },
                {
                    text: "Case reference number"
                },
                {
                    text: "Conditional release date"
                },
                {
                    text: ''
                }
            ],
            rows: offenders
        }) }}
    </form>
{% endblock %}
