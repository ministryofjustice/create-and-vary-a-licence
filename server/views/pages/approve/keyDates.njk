{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}

{% macro keyDates(licence, isDueForEarlyRelease) %}

    {% set releaseDate = '<span class="urgent-highlight">' + licence.homeDetentionCurfewActualDate | datetimeToDateShort + '</span><span class="urgent-highlight urgent-highlight-message">HDC release</span>' if licence.kind === 'HDC' else licence.actualReleaseDate | datetimeToDateShort or licence.conditionalReleaseDate | datetimeToDateShort %}

    {% if isDueForEarlyRelease %}
        {% set releaseDateHtml = '<span class="urgent-highlight">' + releaseDate + '</span><span class="urgent-highlight urgent-highlight-message">Early release</span>' %}
    {% else %}
        {% set releaseDateHtml = '<p>' + releaseDate + '</p>' %}
    {% endif %}

    {% set releaseDateHeading = "Release date/HDC start date" if licence.kind === 'HDC' else "Release date" %}

    {% set dateRows = [
            {
                key: { text: releaseDateHeading, classes: "release-date-heading" },
                value: { html: releaseDateHtml }
            }
        ]
     %}

    {% if licence.kind === 'HDC' %}
        {% set dateRows = (dateRows.push(
                 {
                    key: { text: "HDC end date" },
                    value: { text: licence.homeDetentionCurfewEndDate | datetimeToDateShort, classes: "hdc-end-date" }
                },
                {
                    key: { text: "Conditional release date" },
                    value: { text: licence.conditionalReleaseDate | datetimeToDateShort, classes: "conditional-release-date" }
                }
        ), dateRows) %}
    {% endif %}

     {% if licence.typeCode === 'AP_PSS' or licence.typeCode === 'AP' %}
        {% set dateRows = (dateRows.push(
                 {
                    key: { text: "Licence start date" },
                    value: { text: licence.licenceStartDate | datetimeToDateShort }
                },
                {
                    key: { text: "Licence expiry date" },
                    value: { text: licence.licenceExpiryDate | datetimeToDateShort }
                }
        ), dateRows) %}
    {% endif %}

    {% if licence.typeCode === 'AP_PSS' or licence.typeCode === 'PSS' %}
        {% set dateRows = (dateRows.push(
                {
                    key: { text: "Post sentence supervision order start date" },
                    value: { text: licence.topupSupervisionStartDate | datetimeToDateShort }
                },
                {
                    key: { text: "Post sentence supervision order end date" },
                    value: { text: licence.topupSupervisionExpiryDate | datetimeToDateShort }
                }
        ), dateRows) %}
    {% endif %}

    {{ govukSummaryList({
        attributes: { id: 'key-dates' },
        rows: dateRows
    }) }}

{% endmacro %}
